(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,n){},24:function(e,t,n){e.exports=n.p+"static/media/beep.1775d30f.mp3"},35:function(e,t,n){e.exports=n(68)},40:function(e,t,n){},41:function(e,t,n){},43:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){},60:function(e,t,n){},68:function(e,t,n){"use strict";n.r(t);var s=n(0),a=n.n(s),i=n(11),o=n.n(i),r=(n(40),n(32)),c=n(3),l=n(4),u=n(5),d=n(7),h=n(6),p=n(2),g=n(8),m=(n(41),n(14),n(10)),f=n.n(m),b=n(12),v=(n(43),n(24)),S=n.n(v),y=n(25),w=n.n(y),k=n(16),T=n.n(k),E=T.a.StereoAudioRecorder,O=0,j=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).captureMicrophone=function(e){n.microphone?e(n.microphone):("undefined"!==typeof navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||(alert("This browser does not supports WebRTC getUserMedia API."),navigator.getUserMedia&&alert("This browser seems supporting deprecated getUserMedia API.")),navigator.mediaDevices.getUserMedia({audio:!!n.isEdge||{echoCancellation:!1}}).then(function(t){e(t)}).catch(function(e){alert("Unable to capture your microphone. Please check console logs."),console.error(e)}))},n.toggleListeningMessage=function(e){},n.toggleLoadingMessage=function(){n.props.onLoadingStateChanged(!n.state.loading),n.setState({loading:!n.state.loading})},n.click=function(e){var t=o.a.findDOMNode(e);t.disabled=!1;var n=document.createEvent("Event");n.initEvent("click",!0,!0),t.dispatchEvent(n)},n.appendPlayAudio=function(e){"undefined"!==typeof e&&n.props.onNewMessage({audio:!0,src:e.src})},n.state={message:"",conversationContexts:[],btnStartRecordingDisabled:!1},n.handleSubmit=n.handleSubmit.bind(Object(p.a)(n)),n.handleChange=n.handleChange.bind(Object(p.a)(n)),n.onKeyUp=n.onKeyUp.bind(Object(p.a)(n)),n.onClick=n.onClick.bind(Object(p.a)(n)),n.listening=!1,n.recorder=null,n.microphone=null,n.options=null,n.isEdge=-1!==navigator.userAgent.indexOf("Edge")&&(!!navigator.msSaveOrOpenBlob||!!navigator.msSaveBlob),n.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n.isIos=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),n.audio=null,n.beep=new Audio(S.a),n}return Object(g.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){!1===e.canRecordVoice&&(this.listening&&(console.debug("stopRecording"),this.stopRecording(!1)),this.props.onListeningVoiceEnd())}},{key:"componentDidMount",value:function(){var e=this;this.audio=this.refs.audio,window.addEventListener("message",function(t){if("string"==typeof t.data)switch(t.data){case"onclose":console.debug("stopRecording"),e.stopRecording(!1);break;case"onStartRecording":console.debug("stopRecording"),e.stopRecording(!1,function(){e.setState({btnStartRecordingDisabled:!1}),e.onClick(!0)})}},!1)}},{key:"handleChange",value:function(e){this.setState({message:e.target.value})}},{key:"onKeyUp",value:function(e){13===e.which&&""!==this.state.message.trim()&&(this.handleSubmit(),e.stopPropagation(),e.preventDefault())}},{key:"handleSubmit",value:function(e){e&&e.preventDefault();var t=this.state.message;if(!t||""===t.trim())return!1;this.setState({message:""}),this.props.handleSubmitText(t,void 0,void 0,void 0,void 0,"text_form")}},{key:"getTime",value:function(){return(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},{key:"setListening",value:function(e){var t=this;!0===e?setTimeout(function(){t.listening=e,t.props.onListeningVoiceStart(),t.beep.play()},1e3):(this.listening=e,this.beep.pause(),this.beep.currentTime=0,this.props.onListeningVoiceEnd())}},{key:"setSrcObject",value:function(e,t){"srcObject"in t?t.srcObject=e:"mozSrcObject"in t?t.mozSrcObject=e:t.srcObject=e}},{key:"onClick",value:function(e){var t=this,n=0;if(!1!==this.props.canRecordVoice||!0===e)return this.listening?(this.recorder&&this.recorder.stopRecording(),this.toggleListeningMessage(!1),this.setListening(!1),void clearTimeout(this.to)):void(this.microphone?(this.setListening(!0),this.audio.muted=!0,this.setSrcObject(this.microphone,this.audio),this.to=setTimeout(function(){t.stopRecording(!0)},7e3),this.options={type:"audio",numberOfAudioChannels:1,checkForInactiveTracks:!0,mimeType:"audio/ogg",recorderType:E,desiredSampRate:16e3,disableLogs:!0,timeSlice:50,ondataavailable:function(e,s){var a=Number(s.instant);a>O&&(O=a),a>.4*O?(n=0,t.props.onRecording()):n++,n>40&&(n=0,console.debug("stopRecording"),clearTimeout(t.to),t.stopRecording(!0))}},navigator.platform&&-1===navigator.platform.toString().toLowerCase().indexOf("win")&&(this.options.sampleRate=48e3),this.isSafari&&(this.options.sampleRate=44100,this.options.bufferSize=4096),this.recorder&&(this.recorder.destroy(),this.recorder=null),this.recorder=T()(this.microphone,this.options),this.recorder.startRecording(),this.toggleListeningMessage()):this.captureMicrophone(function(e){if(t.microphone=e,t.isSafari)return t.audio.muted=!0,t.setSrcObject(t.microphone,t.audio),void t.setState({btnStartRecordingDisabled:!1});t.click(t.refs.btnStartRecording),t.setListening(!0)}))}},{key:"stopRecording",value:function(e,t){var n=this;this.recorder||t&&t(),clearTimeout(this.to),this.recorder&&this.recorder.stopRecording(function(){n.setListening(!1),n.toggleListeningMessage(!1),n.props.onRecording(),n.setState({btnStartRecordingDisabled:!1}),setTimeout(function(){n.audio.paused&&setTimeout(function(){n.audio.paused},1e3)},300),setTimeout(function(){e&&n.sendRecording()},500),n.isSafari&&(n.setState({btnStartRecordingDisabled:!1}),n.microphone&&(n.microphone.stop(),n.microphone=null)),t&&t()})}},{key:"sendRecording",value:function(){var e=this;this.props.onRecording(),this.recorder.getDataURL(function(){var t=Object(b.a)(f.a.mark(function t(n){var s;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.toggleLoadingMessage(),s=e,e.props.handleSubmitAudio(n.substr(n.indexOf(",")+1),e.options).then(function(t){if(s.props.onRecording(),s.setState({btnStartRecordingDisabled:!1}),e.toggleLoadingMessage(),e.isSafari&&s.click(s.refs.btnStartRecording),"undefined"!==typeof t.response){console.log(t.response),"undefined"!==typeof t.response.queryText&&s.props.onNewMessage({sender:"user",message:t.response.queryText,time:e.getTime()}),"undefined"!==typeof t.response.fulfillmentText?s.props.onNewMessage({sender:"bot",message:t.response.fulfillmentText,time:e.getTime()}):s.props.onNewMessage({sender:"user",message:t.response.queryText,time:e.getTime()}),t.response.outputAudio;var n=new Audio("data:audio/mp3;base64,"+t.response.outputAudio);e.isSafari?(s.appendPlayAudio(n),s.setState({btnStartRecordingDisabled:!1})):s.setState({btnStartRecordingDisabled:!0}),n.play().then(function(){s.setState({btnStartRecordingDisabled:!1}),s.props.onRecording()}).catch(function(){console.log("Sound not played")})}}).catch(function(e){s.toggleLoadingMessage(),s.setState({btnStartRecordingDisabled:!1})});case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"render",value:function(){var e=this;return a.a.createElement("form",{method:"POST",action:"query",ref:"query_form",onSubmit:this.handleSubmit,style:{display:"flex"}},a.a.createElement("div",{style:{top:"-1000px",left:0,height:0,position:"absolute",width:0}},a.a.createElement("audio",{controls:"",autoPlay:"",ref:"audio"})),a.a.createElement("div",{className:"input-form"},!0!==this.props.text?null:a.a.createElement(w.a,{value:this.state.message,onChange:this.handleChange,onKeyDown:this.onKeyUp,style:{fontSize:"1rem",margin:"2vh",borderRadius:"10px"},form:"query_form",rows:2,className:"form-control type_msg",placeholder:this.props.textInputPlaceholder,id:"input_text",name:"input_text",ref:"text"}),a.a.createElement("input",{type:"submit",style:{top:"-1000px",left:0,height:0,position:"absolute",width:0}}),a.a.createElement("input",{placeholder:"Language",type:"text",id:"input_language",name:"input_language",style:{display:"none"}}),a.a.createElement("div",{style:{display:"flex",alignItems:"center",margin:"auto",padding:"0 5px",borderRadius:"50%"}},!0===this.props.microphone?a.a.createElement("button",Object.assign({},this.state.btnStartRecordingDisabled?{disabled:"disabled"}:null,{type:"button",className:"record_btn microphone",ref:"btnStartRecording",id:"btn-start-recording",onClick:function(){return e.onClick()}})):!0===this.props.text?a.a.createElement("button",{type:"button",className:"record_btn",id:"submit-btn",onClick:function(){return e.handleSubmit(null)}}):null),a.a.createElement("span",{style:{clear:"both"}})))}}]),t}(s.Component),x=n(34),R=n(26),C=n.n(R),L=(n(50),n(51),function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{style:{float:"none",margin:"0 auto"},className:"lds-ellipsis"},a.a.createElement("div",null),a.a.createElement("div",null),a.a.createElement("div",null),a.a.createElement("div",null))}}]),t}(s.Component));n(19);C.a.polyfill();var M,N=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={tree:e.suggestions?n.normalize(e.suggestions):[],currentPath:[],currentQuerying:[],querying:!e.suggestions,hidden:!1,lastChoice:-1,openMenu:!1,opened:!1,shouldOpenMenu:!0,hideLastChoice:!1},n.popStatus=n.popStatus.bind(Object(p.a)(n)),n.resetStatus=n.resetStatus.bind(Object(p.a)(n)),n.seleziona={cn:"\u9009\u62e9",de:"W\xe4hlen",en:"Select",es:"Seleccionar",fr:"S\xe9lectionner",it:"Seleziona",jp:"\u9078\u629e\u3059\u308b",ru:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c"},n}return Object(g.a)(t,e),Object(u.a)(t,[{key:"normalize",value:function(e){var t=this;return e.map(function(e){return Object(c.a)({},e,e.nodes?{nodes:t.normalize(e.nodes),hasChildren:!0}:{})})}},{key:"componentDidMount",value:function(){var e=this;"object"!==typeof this.props.suggestions&&setTimeout(function(){e.fetchSuggestions(e.props.onFirstLoadComplete)},0)}},{key:"fetchLabelTranslation",value:function(){var e=Object(b.a)(f.a.mark(function e(t){var n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"===typeof t.label){e.next=8;break}return e.next=3,fetch("translateLabel/".concat(this.props.locale,"/").concat(t.label),{method:"GET"});case 3:return n=e.sent,e.next=6,n.json();case 6:n=e.sent,t.label=n.label;case 8:return e.abrupt("return",t.label);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchSuggestions",value:function(){var e=Object(b.a)(f.a.mark(function e(t){var n,s,a,i=this;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,this.props.suggestions){e.next=24;break}return s=setTimeout(function(){i.setState({querying:!0,openMenu:!1,opened:!1})},300),this.setState({tree:[]}),e.next=6,fetch("suggestions/".concat(this.props.locale,"/").concat(this.state.currentPath.join(",")),{method:"GET"});case 6:return a=e.sent,e.prev=7,e.next=10,a.json();case 10:a=e.sent,e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(7),console.log("wait for it...."),e.next=18,new Promise(function(e){return setTimeout(e,1e3)});case 18:return e.abrupt("return",this.fetchSuggestions(t));case 19:return e.next=21,this.isShowAsSelect();case 21:return e.next=23,Promise.all(a.data).then(function(e){n.setState({tree:e,label:a.label,currentPath:a.currentPath,querying:!1},function(){t&&t()})});case 23:clearTimeout(s);case 24:case"end":return e.stop()}},e,this,[[7,13]])}));return function(t){return e.apply(this,arguments)}}()},{key:"pushNewStatus",value:function(e){this.state.querying||(this.props.scrollToBottom(),this.setState(function(t){return t.currentQuerying.push(t.tree[e]),t.currentPath.push(e),t.showLeftArrow=!1,t.lastChoice=-1,t},this.fetchSuggestions))}},{key:"popStatus",value:function(){this.state.querying||(this.props.scrollToBottom(),this.setState(function(e){return e.currentPath.pop(),e.showLeftArrow=!1,e.lastChoice=-1,e.currentQuerying.pop(),e},this.fetchSuggestions))}},{key:"resetStatus",value:function(){this.state.querying||(this.props.scrollToBottom(),this.setState({currentPath:[],showLeftArrow:!1,lastChoice:-1},this.fetchSuggestions),this.props.resetStatus())}},{key:"runQuestion",value:function(e,t,n){this.setState({showLeftArrow:!1,hidden:!0===this.props.oneshot,lastChoice:t}),e&&this.props.handleSubmit(e,void 0,void 0,void 0,n,"wizard"),(n.response||n.action)&&this.props.handleOfflineResponse(n)}},{key:"isShowAsSelect",value:function(){var e=Object(b.a)(f.a.mark(function e(){var t=this;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("suggestions/".concat(this.props.locale,"/")+this.state.currentPath.join(","),{method:"GET"}).then(function(e){return e.json()}).then(function(e){var n=e.showAsSelect,s=void 0!==n&&n;t.setState({showAsSelect:s,hideLastChoice:!1})});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"renderAsSelect",value:function(e,t){var n=this,s=e.map(function(e,n){return e&&!1!==e.enabled?{value:n,key:t+n,label:e.label}:null}),i={option:function(e,t){return Object(c.a)({},e,{color:"#000000",backgroundColor:"#e5e5e5",padding:"2.6vw 4vw",boxShadow:"none"})},control:function(){return{color:"#000000",padding:"2.6vw 4vw",margin:0,boxShadow:"none"}},indicatorsContainer:function(){return{height:20,position:"absolute",right:"3%",top:"calc(50% - 20px)"}},dropdownIndicator:function(){return{height:20,color:"#000000"}}};return!1===this.state.opened&&!1===this.state.openMenu&&setTimeout(function(){return n.setState({openMenu:!0,opened:!0})},250),a.a.createElement(x.a,{key:t,className:"select",onChange:function(t){var s=e[t.value];s.hasChildren?n.pushNewStatus(t.value):n.runQuestion(s.question,void 0,s)},options:s,styles:i,isSearchable:!1,placeholder:this.seleziona[this.props.locale],menuPlacement:"bottom",maxMenuHeight:"50vh",onMenuClose:function(){n.setState({openMenu:!1})},onMenuOpen:function(){n.setState({openMenu:!0})},menuIsOpen:!0===this.state.openMenu,minMenuHeight:"10vh",classNamePrefix:"react-select",theme:function(e){return Object(c.a)({},e,{borderRadius:0,colors:Object(c.a)({},e.colors,{primary50:"rgb(145, 145, 145)"})})}})}},{key:"renderSuggestionChips",value:function(e,t){var n=this;return e.map(function(e,s){return!e||!1===e.enabled||n.state.lastChoice===s&&!0===n.state.hideLastChoice?null:[a.a.createElement("div",{className:"suggestion_chip"+(n.state.label?" child":""),key:t+s,onMouseDown:function(){return e.hasChildren?n.pushNewStatus(s):n.runQuestion(e.question,s,e)}},a.a.createElement("div",null,a.a.createElement("div",null,e.label)))]})}},{key:"render",value:function(){var e=this,t=this.state.tree;this.props.suggestions&&this.state.currentPath.map(function(e){return t=t[e].nodes});var n=this.state.showAsSelect,s=this.state.currentPath.join(",")+",",i=[this.state.label?[a.a.createElement("div",{style:{display:"table"},key:"parent",onClick:function(){return e.popStatus()},className:"suggestion_chip parent"},a.a.createElement("div",{style:{display:"table-cell",verticalAlign:"middle",margin:"0 auto"}},a.a.createElement("div",null,this.state.label)))]:[]];return!0===this.state.hidden?null:a.a.createElement("div",{style:{position:"relative",marginTop:"20px"}},a.a.createElement("div",{ref:"container",style:{overflowX:"none",textAlign:"right"}},this.state.querying?[this.state.currentQuerying.length>0?this.renderSuggestionChips([this.state.currentQuerying[this.state.currentQuerying.length-1]]):null,a.a.createElement(L,{key:"loader"})]:[[].concat(i,[n?this.renderAsSelect(t,s):this.renderSuggestionChips(t,s)]),this.props.suggestions?[a.a.createElement("div",{key:"-2",className:"suggestion_chip",onClick:this.popStatus},"Indietro")]:null],a.a.createElement("span",{style:{clear:"both"}})))}}]),t}(s.Component),P=n(33),I=(n(60),n(30)),_=n.n(I),A=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).state=Object(c.a)({},e),n}return Object(g.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.index,t=this.props.element,n="user"===t.sender;if(t.audio)return a.a.createElement("div",{className:"",key:"audio"+t.src},a.a.createElement("div",{className:"info_container_send",style:{float:"left"}},a.a.createElement("audio",{controls:!0,src:t.src,style:{width:"auto"}})));var s={containerClass:n?"msg_container":"msg_container_send",containerStyle:{float:n?"right":"left"},timeClass:n?"msg_time":"msg_time_send",who:n},i=null;if(t.action)switch(t.action){case"show-openings":i=this.renderOpeningHours(t.parameters[0].openings)}return""!==t.message||null!==i?a.a.createElement("div",{className:"",key:"msg"+e},a.a.createElement("div",{className:s.containerClass,style:s.containerStyle},i,a.a.createElement(_.a,{properties:{target:"_blank"}},t.message),null)):null}},{key:"renderOpeningHours",value:function(e){var t=((new Date).getDay()-1)%7;return[(e=[0,1,2,3,4,5,6].map(function(n){return e[(n+t)%7]})).map(function(e,t){return Object.keys(e).map(function(n){return a.a.createElement("p",{key:t,style:{marginBottom:"5px",display:"inline-block",width:"100%"}},0===t?a.a.createElement("b",{style:{float:"left",width:"45%"}},n," "):a.a.createElement("span",{style:{float:"left",width:"45%"}},n," "),a.a.createElement("span",{style:{float:"right",width:"55%"}},e[n]),a.a.createElement("span",{style:{clear:"both"}}))})}),a.a.createElement("p",{style:{clear:"both"},key:"-1"})]}}]),t}(s.Component),D=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).scrollToBottom=function(){setTimeout(function(){Object(P.a)(n.messagesEnd,{scrollMode:"if-needed",behavior:"smooth"})},n.isSafari?1e3:200)},n.state=Object(c.a)({},e),n.handleSubmitText=n.handleSubmitText.bind(Object(p.a)(n)),n}return Object(g.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this,n=e.messages,s=e.listening,a=e.loading;this.setState({messages:n,listening:s,loading:a},function(){setTimeout(function(){t.scrollToBottom()},200)})}},{key:"handleSubmitText",value:function(e,t,n,s,a,i){this.props.handleSubmitText(e,t,n,s,a,i),this.scrollToBottom()}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"card-body msg_card_body "+this.props.className,id:"card_body",ref:"container"},a.a.createElement("div",null),this.state.messages.map(function(t,n){return t.suggestions?!1!==e.props.wizard?a.a.createElement(N,Object.assign({backToTop:e.props.backToTop},t.oneshot?{oneshot:!0}:{},"object"===typeof t.suggestions?Object(c.a)({suggestions:t.suggestions,responseId:t.responseId},Object(c.a)({},t.action?{action:t.action}:{}),Object(c.a)({},t.parameters?{parameters:t.parameters}:{})):{},{onFirstLoadComplete:function(){e.scrollToBottom(),e.setState({loadingSuggestions:!1})},key:"suggestions"+n,resetStatus:e.props.resetStatus,handleSubmit:e.handleSubmitText,handleOfflineResponse:e.props.handleOfflineResponse,locale:e.props.locale,scrollToBottom:e.scrollToBottom})):null:a.a.createElement(A,{index:n,element:t,key:n})}),0===this.state.messages.length||!this.state.messages[this.state.messages.length-1].suggestions&&"user"!==this.state.messages[this.state.messages.length-1].sender&&!0===this.props.wizard?1===this.state.messages.length?a.a.createElement(N,{backToTop:this.props.backToTop,onFirstLoadComplete:function(){e.scrollToBottom(),e.setState({loadingSuggestions:!1})},key:"suggestions0",resetStatus:this.props.resetStatus,handleSubmit:this.handleSubmitText,handleOfflineResponse:this.props.handleOfflineResponse,locale:this.props.locale,scrollToBottom:this.scrollToBottom}):a.a.createElement("div",{className:"suggestion_chip show_suggestions",style:{marginTop:"20px"},onClick:function(){e.props.onNewMessage({suggestions:!0}),e.setState({loadingSuggestions:!0}),setTimeout(function(){e.scrollToBottom()},200)}},a.a.createElement("div",null,a.a.createElement("div",null,this.props.labelShowSuggestions))):null,a.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}},!1===this.state.listening?null:a.a.createElement("div",{className:"",id:"loading_message"},a.a.createElement("div",{className:"info_container_send loading_message"},this.props.listeningLabel)),!1===this.state.loading?null:a.a.createElement("div",{id:"loading_message",className:"lds-ellipsis"},a.a.createElement("div",null),a.a.createElement("div",null),a.a.createElement("div",null),a.a.createElement("div",null))))}},{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}}]),t}(s.Component),z=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).welcome_message={en:"I'm Lamborghini's first Artificial Intelligence, how can I help you?",it:"Sono la prima Intelligenza Artificiale di Lamborghini, come posso aiutarti?",de:"Ich bin die erste k\xfcnstliche Intelligenz von Lamborghini, wie kann ich Ihnen helfen?",es:"Soy la primera Inteligencia Artificial de Lamborghini, \xbfc\xf3mo puedo ayudarte?",fr:"Je suis la premi\xe8re Intelligence Artificielle Lamborghini, comment puis-je vous \xeatre utile?",ru:"\u042f \u043f\u0435\u0440\u0432\u044b\u0439 \u0418\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0418\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442 Lamborghini, \u043a\u0430\u043a \u044f \u043c\u043e\u0433\u0443 \u043f\u043e\u043c\u043e\u0447\u044c?",ja:"\u79c1\u306f\u30e9\u30f3\u30dc\u30eb\u30ae\u30fc\u30cb\u521d\u306e\u4eba\u5de5\u77e5\u80fd\u3001AI\u3067\u3059\u3002\u4f55\u3092\u304a\u805e\u304d\u306b\u306a\u308a\u305f\u3044\u3067\u3059\u304b\uff1f","zh-cn":"\u6211\u662f\u5170\u535a\u57fa\u5c3c\u7684\u7b2c\u4e00\u4e2a\u4eba\u5de5\u667a\u80fd\uff0c\u6211\u8be5\u5982\u4f55\u5e2e\u52a9\u60a8\uff1f"},n.labelShowSuggestions={en:"Show suggestions",it:"Mostra suggerimenti",de:"Vorschl\xe4ge anzeigen","zh-cn":"\u663e\u793a\u5efa\u8bae",ja:"\u30a2\u30c9\u30d0\u30a4\u30b9\u3092\u8868\u793a\u3059\u308b",ru:"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u043e\u0432\u0435\u0442\u044b",es:"Mostrar sugerencias",fr:"Afficher les suggestions"},n.backToTop={en:"Return to the initial suggestions",it:"Torna ai suggerimenti iniziali",de:"Zu den ersten Vorschl\xe4gen zur\xfcckkehren","zh-cn":"\u56de\u5230\u6700\u521d\u7684\u5efa\u8bae",ja:"\u6700\u521d\u306e\u30a2\u30c9\u30d0\u30a4\u30b9\u306b\u623b\u308b",ru:"\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043a \u043f\u0435\u0440\u0432\u043e\u043d\u0430\u0447\u0430\u043b\u044c\u043d\u044b\u043c \u0441\u043e\u0432\u0435\u0442\u0430\u043c",es:"Volver a las sugerencias iniciales",fr:"Revenir aux suggestions initiales"},n.textInputPlaceholder={en:"Hey, ask me something\u2026",it:"Ciao, chiedimi qualcosa\u2026",de:"Hallo, fragen Sie mich etwas...","zh-cn":"\u55e8\uff0c\u95ee\u6211\u4e00\u4e9b\u4e8b\u5427......",ja:"\u3069\u3046\u305e\u3001\u4f55\u304b\u3054\u8cea\u554f\u304f\u3060\u3055\u3044...",ru:"\u042d\u0439, \u0441\u043f\u0440\u043e\u0441\u0438\u0442\u0435 \u0443 \u043c\u0435\u043d\u044f \u0447\u0442\u043e-\u043d\u0438\u0431\u0443\u0434\u044c ...",es:"Preg\xfanteme algo",fr:"H\xe9, posez-moi une question\u2026"},n.secondTip={en:a.a.createElement("span",null,"You can choose one of the suggestions or ask me a question"),it:a.a.createElement("span",null,"Puoi scegliere uno dei suggerimenti o farmi una domanda"),de:a.a.createElement("span",null,"Sie k\xf6nnen einen der Vorschl\xe4ge ausw\xe4hlen oder mir eine Frage stellen"),"zh-cn":a.a.createElement("span",null,"\u60a8\u53ef\u4ee5\u9009\u62e9\u5176\u4e2d\u7684\u4e00\u4e2a\u5efa\u8bae\u6216\u5411\u6211\u63d0\u95ee"),ja:a.a.createElement("span",null,"\u30a2\u30c9\u30d0\u30a4\u30b9\u306e\u4e00\u3064\u3092\u9078\u629e\u3059\u308b\u304b\u3001\u8cea\u554f\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059"),ru:a.a.createElement("span",null,"\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u043e\u0434\u0438\u043d \u0438\u0437 \u0441\u043e\u0432\u0435\u0442\u043e\u0432 \u0438\u043b\u0438 \u0437\u0430\u0434\u0430\u0442\u044c \u043c\u043d\u0435 \u0432\u043e\u043f\u0440\u043e\u0441"),es:a.a.createElement("span",null,"Puedes elegir una de las sugerencias o hacerme una pregunta"),fr:a.a.createElement("span",null,"Vous pouvez choisir l\u2019une des suggestions ou me poser une question")},n.listening_labels={en:"Listening...",it:"In ascolto...",de:"H\xf6rt zu...","zh-cn":"\u542c...",ja:"\u805e\u304d\u53d6\u308a\u4e2d...",ru:"\u0421\u043b\u0443\u0448\u0430\u044e...",es:"Escuchando...",fr:"\xc9coute en cours\u2026"},n.timeoutID=null,n.locales={it:"Italiano",en:"English",de:"Deutsch",fr:"Fran\xe7aise",es:"Espa\xf1ol",ru:"\u0440\u0443\u0441\u0441\u043a\u0438\u0439",ja:"\u65e5\u672c\u4eba"},n.headers={Accept:"application/json","Content-Type":"application/json"},n.state={messages:[],locale:e.locale},n.onNewMessage=n.onNewMessage.bind(Object(p.a)(n)),n.handleSubmitText=n.handleSubmitText.bind(Object(p.a)(n)),n.handleSubmitAudio=n.handleSubmitAudio.bind(Object(p.a)(n)),n.onListeningVoiceStart=n.onListeningVoiceStart.bind(Object(p.a)(n)),n.onListeningVoiceEnd=n.onListeningVoiceEnd.bind(Object(p.a)(n)),n.onLoadingStateChanged=n.onLoadingStateChanged.bind(Object(p.a)(n)),n.resetStatus=n.resetStatus.bind(Object(p.a)(n)),n.handleOfflineResponse=n.handleOfflineResponse.bind(Object(p.a)(n)),n.onRecording=n.onRecording.bind(Object(p.a)(n)),n.startIdleTimeout(),n}return Object(g.a)(t,e),Object(u.a)(t,[{key:"initState",value:function(e){var t=this;this.setState({messages:[]},function(){t.setState({loading:!1,listening:!1,languagesShow:!1,canRecordVoice:!0,locale:e,labelShowSuggestions:t.labelShowSuggestions[e],backToTop:t.backToTop[e],messages:[{sender:"bot",message:t.welcome_message[e],time:t.getTime()},{sender:"bot",message:t.secondTip[e],time:t.getTime()}],conversationContexts:[]})})}},{key:"componentWillReceiveProps",value:function(e){this.setState({hello:e.myvar})}},{key:"onNewMessage",value:function(e){this.setState(function(t){return Object(c.a)({},t,{messages:[].concat(Object(r.a)(t.messages),[e])})})}},{key:"resetStatus",value:function(){this.setState({conversationContexts:[]})}},{key:"handleSubmitText",value:function(e,t,n,s,a,i){var o=this;this.onNewMessage({sender:"user",message:e,time:this.getTime()});var r=function(){o.clearIdleTimeout(),fetch("query",{method:"POST",headers:o.headers,body:JSON.stringify(o.getForm(e,a&&a.clientParams,i))}).then(function(e){return e.json()}).then(function(e){return o.handleSuccess(e)}).catch(function(e){return o.handleException(e)})};!0===s?this.setState({conversationContexts:[],resetContexts:!0},r):r()}},{key:"handleSubmitAudio",value:function(e,t){var n=this.getForm(null);n.file=e,n.sampleRate=t.desiredSampRate;var s=this;return this.clearIdleTimeout(),fetch("audio",{method:"POST",headers:this.headers,body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){return s.setState({conversationContexts:e.response.contexts}),e})}},{key:"startIdleTimeout",value:function(){var e=this;!1!==this.props.checkTimeout&&(console.debug(this.props.timeoutInterval,"seconds"),this.timeoutID=window.setTimeout(function(){window.parent.postMessage("BOT_TIMED_OUT","http://lamborghini.staging.lamborghini.nohup.it/chatbot/milano/"),window.parent.postMessage("BOT_TIMED_OUT","https://wwww.lamborghini.com/milano/"),e.setState({canRecordVoice:!1}),console.debug("timeout")},1e3*this.props.timeoutInterval*2))}},{key:"clearIdleTimeout",value:function(){window.clearTimeout(this.timeoutID),this.startIdleTimeout(),console.debug("clearIdleTimeout")}},{key:"handleSuccess",value:function(e){var t,n=this;this.setState({conversationContexts:e.response.contexts,resetContexts:!1}),this.onNewMessage(Object(c.a)({sender:"bot",message:e.response.fulfillmentText,time:this.getTime()},Object(c.a)({},e.response.action?{action:e.response.action}:{}),Object(c.a)({},e.response.parameters?{parameters:e.response.parameters}:{}))),e.response.suggestions&&this.onNewMessage(Object(c.a)({suggestions:e.response.suggestions,oneshot:!0,responseId:e.response.responseId},Object(c.a)({},e.response.action?{action:e.response.action}:{}),Object(c.a)({},e.response.parameters?{parameters:e.response.parameters}:{}))),e.response.outputAudio,t=e.response.outputAudio,setTimeout(function(){console.log("base64 "),n.sound&&n.sound.pause(),n.sound=new Audio("data:audio/mp3;base64,"+t),n.sound.addEventListener("ended",function(){}),n.sound.play().then(function(){console.log("playing")}).catch(function(e){console.error(e)})},100)}},{key:"componentDidMount",value:function(){var e=this;this.initState(this.state.locale),window.addEventListener("message",function(t){if("object"==typeof t.data)switch(t.data.type){case"question":var n=e;setTimeout(function(){n.handleSubmitText(t.data.text,void 0,void 0,!0)},300);break;case"onLocaleChange":e.setState({locale:t.data.locale}),e.initState(t.data.locale);break;default:return null}if("string"==typeof t.data)switch(t.data){case"onStartRecording":e.setState({canRecordVoice:!0}),e.startIdleTimeout()}},!1)}},{key:"handleOfflineResponse",value:function(e){this.onNewMessage({sender:"bot",message:e.response,action:e.action,parameters:e.parameters})}},{key:"handleException",value:function(e){this.onNewMessage({sender:"bot",message:"I didn't understand that"})}},{key:"getTime",value:function(){return(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},{key:"getForm",value:function(e,t,n){return{input_text:e,input_language:this.state.locale,contexts:this.state.conversationContexts,cookie:window.location.pathname.split("/s-")[1],latitude:this.state.latitude,longitude:this.state.longitude,resetContexts:this.state.resetContexts,queryType:n,clientParams:t}}},{key:"renderBadge",value:function(e){return a.a.createElement("div",null,e)}},{key:"onListeningVoiceEnd",value:function(){this.setState({listening:!1,canRecordVoice:!0})}},{key:"onListeningVoiceStart",value:function(){this.setState({listening:!0})}},{key:"onLoadingStateChanged",value:function(e){this.setState({loading:e})}},{key:"onRecording",value:function(){this.clearIdleTimeout()}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"container-fluid h-100"},a.a.createElement("div",{className:"row justify-content-center h-100",id:"chat_text"},a.a.createElement("div",{className:"chat"},a.a.createElement("div",{className:"card",style:{overflowX:"hidden"}},!1!==this.props.header?a.a.createElement("div",{className:"header"},a.a.createElement("div",{className:"header-logo"}),a.a.createElement("div",{className:"back-arrow"}),a.a.createElement("div",{style:{clear:"both"}})):null,a.a.createElement(D,{className:!1===this.props.microphone&&!1===this.props.text?"form_hidden":"",wizard:this.props.wizard,resetStatus:this.resetStatus,labelShowSuggestions:this.state.labelShowSuggestions,backToTop:this.state.backToTop,handleSubmitText:this.handleSubmitText,locale:this.state.locale,onNewMessage:this.onNewMessage,messages:this.state.messages,listening:this.state.listening,listeningLabel:this.listening_labels[this.state.locale],handleOfflineResponse:this.handleOfflineResponse,loading:this.state.loading}),!0===this.props.microphone||!0===this.props.text?[a.a.createElement("hr",{key:"hr-1",style:{marginTop:"5vh"}}),a.a.createElement(j,{key:"form",text:this.props.text,canRecordVoice:this.state.canRecordVoice,microphone:this.props.microphone,recording:this.state.recording,onNewMessage:this.onNewMessage,handleSubmitText:this.handleSubmitText,handleSubmitAudio:this.handleSubmitAudio,onListeningVoiceStart:this.onListeningVoiceStart,onListeningVoiceEnd:this.onListeningVoiceEnd,onLoadingStateChanged:this.onLoadingStateChanged,onRecording:this.onRecording,textInputPlaceholder:this.textInputPlaceholder[this.state.locale]}),a.a.createElement("hr",{key:"hr-2"})]:null),a.a.createElement("div",{className:"slider"+(this.state.languagesShow?"":" closed")},Object.keys(this.locales).filter(function(t){return t!==e.state.locale}).map(function(t){return[a.a.createElement("div",{key:t,onClick:function(){return e.initState(t)}},e.locales[t]),a.a.createElement("hr",{key:"hr"+t})]})))))}}]),t}(s.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));(M=window).URLSearchParams=M.URLSearchParams||function(e){var t=this;t.searchString=e,t.get=function(e){var n=new RegExp("[?&]"+e+"=([^&#]*)").exec(t.searchString);return null==n?null:decodeURI(n[1])||0}};var V=new URL(window.location.href);"undefined"==typeof V.searchParams&&(V.searchParams=new URLSearchParams(V.search));var B=V.searchParams.get("lang")?V.searchParams.get("lang"):"en";"undefined"===B&&(B="en"),"cn"===B&&(B="zh-cn"),"jp"===B&&(B="ja");var q=!0;"0"===V.searchParams.get("text")&&(q=!1);var U=!1;"1"===V.searchParams.get("microphone")&&(U=!0);var F=!1;"1"===V.searchParams.get("header")&&(F=!0);var Q=!1;"1"===V.searchParams.get("checkTimeout")&&(Q=!0);var H=!1;"1"===V.searchParams.get("wizard")&&(H=!0);var W=180;V.searchParams.get("timeoutInterval")&&(W=parseInt(V.searchParams.get("timeoutInterval"))),o.a.render(a.a.createElement(z,{locale:B,header:F,microphone:U,text:q,wizard:H,timeoutInterval:W,checkTimeout:Q}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[35,1,2]]]);
//# sourceMappingURL=main.a7d0ba3d.chunk.js.map